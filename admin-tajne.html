<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>üçã Panel Szefa - Lemoniada</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: auto; }

        /* KARTY STATYSTYK */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .card { background: #2d2d2d; padding: 15px; border-radius: 15px; border: 1px solid #3d3d3d; }
        .money { font-size: 24px; color: #2ecc71; font-weight: bold; }

        /* MAGAZYN */
        .magazyn-box { background: #34495e; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center; }
        input { padding: 10px; width: 60px; border-radius: 8px; border: none; font-size: 18px; text-align: center; }

        /* PRZYCISKI */
        button { cursor: pointer; border: none; font-weight: bold; transition: 0.2s; }
        .btn-main { background: #f1c40f; color: #000; padding: 10px 20px; border-radius: 8px; }
        .btn-status { padding: 5px 10px; border-radius: 5px; font-size: 12px; margin-top: 5px; }
        .btn-reset { background: #e74c3c; color: white; width: 100%; padding: 15px; border-radius: 12px; margin-top: 30px; font-size: 16px; }

        /* LISTA ZAM√ìWIE≈É */
        .order { background: white; color: black; padding: 15px; border-radius: 12px; margin-bottom: 10px; position: relative; }
        .status-tag { position: absolute; top: 10px; right: 10px; font-size: 11px; font-weight: bold; padding: 3px 7px; border-radius: 4px; }
        .tag-PRZYJƒòTE { background: #f1c40f; }
        .tag-GOTOWE { background: #2ecc71; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2>üìä ZarzƒÖdzanie Stoiskiem</h2>

    <div class="magazyn-box">
        <h3 style="margin-top:0;">Dostƒôpne kubki: <span id="current-cups">?</span></h3>
        <input type="number" id="cups-input" value="50">
        <button class="btn-main" onclick="setCups()">USTAW STAN</button>
    </div>

    <div class="stat-grid">
        <div class="card">
            <small>UTARG CA≈ÅKOWITY</small>
            <div class="money"><span id="total-money">0.00</span> z≈Ç</div>
        </div>
        <div class="card">
            <small>SPRZEDANE SZTUKI</small>
            <div style="font-size: 24px; font-weight: bold;" id="total-count">0</div>
        </div>
    </div>

    <div class="card" style="margin-bottom: 20px;">
        <h4>üì¶ Sprzedano dzi≈õ:</h4>
        <div id="product-stats" style="line-height: 1.6;">Wczytywanie...</div>
        <hr style="opacity:0.1">
        <div id="payment-stats" style="color: #bdc3c7;">Wczytywanie...</div>
    </div>

    <h3>üìù Aktywne Zam√≥wienia</h3>
    <div id="orders-list"></div>

    <button class="btn-reset" onclick="resetDay()">üßπ KONIEC DNIA (RESET BAZY)</button>

</div>

<script>
    const API = "https://bacterial-concept-scripting-expired.trycloudflare.com";

    // 1. Ustawianie kubk√≥w
    function setCups() {
        const val = document.getElementById('cups-input').value;
        fetch(`${API}/ustaw-kubki`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ ilosc: val })
        }).then(() => {
            alert("Zaktualizowano magazyn!");
            loadData();
        });
    }

    // 2. ≈Åadowanie danych i statystyk
    function loadData() {
        // Pobierz stan magazynu
        fetch(`${API}/stan-magazynu`).then(r => r.json()).then(stan => {
            document.getElementById('current-cups').innerText = stan.kubki;
        });

        // Pobierz zam√≥wienia i przelicz statystyki
        fetch(`${API}/list-zamowienia`).then(r => r.json()).then(data => {
            let total = 0;
            let products = { "Klasyczna": 0, "Pomara≈Ñczowa": 0 };
            let payments = { "Got√≥wka": 0, "BLIK": 0 };
            const list = document.getElementById('orders-list');
            list.innerHTML = "";

            data.forEach(z => {
                const cena = parseFloat(z.suma);
                total += cena;

                // Statystyki produkt√≥w
                if(z.produkty.includes("Klasyczna")) products["Klasyczna"]++;
                if(z.produkty.includes("Pomara≈Ñczowa")) products["Pomara≈Ñczowa"]++;

                // Statystyki p≈Çatno≈õci
                if(z.platnosc.includes("Got√≥wka")) payments["Got√≥wka"] += cena;
                else payments["BLIK"] += cena;

                // Wy≈õwietlanie listy (tylko dzisiejsze/niezarchiwizowane)
                list.innerHTML += `
                    <div class="order">
                        <span class="status-tag tag-${z.status}">${z.status}</span>
                        <b>#${z.id}</b> | ${z.godzina} | <b>${z.suma} z≈Ç</b><br>
                        <small>${z.produkty}</small><br>
                        <small>P≈Çatno≈õƒá: ${z.platnosc}</small><br>
                        ${z.status === 'PRZYJƒòTE' ?
                    `<button class="btn-status" style="background:#2ecc71; color:white;" onclick="updateStatus(${z.id}, 'GOTOWE')">OZNACZ JAKO WYDANE</button>` :
                    `<span style="color:gray; font-size:11px;">Zrealizowano ‚úì</span>`}
                    </div>
                `;
            });

            document.getElementById('total-money').innerText = total.toFixed(2);
            document.getElementById('total-count').innerText = data.length;
            document.getElementById('product-stats').innerHTML = `
                üçã Klasyczna: <b>${products["Klasyczna"]}</b> szt.<br>
                üçä Pomara≈Ñczowa: <b>${products["Pomara≈Ñczowa"]}</b> szt.
            `;
            document.getElementById('payment-stats').innerHTML = `
                Got√≥wka: ${payments["Got√≥wka"].toFixed(2)} z≈Ç | BLIK: ${payments["BLIK"].toFixed(2)} z≈Ç
            `;
        });
    }

    // 3. Zmiana statusu na "Wydane"
    function updateStatus(id, nowyStatus) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id, nowyStatus })
        }).then(() => loadData());
    }

    // 4. RESET DNIA (To o co prosi≈Çe≈õ)
    function resetDay() {
        if(confirm("UWAGA! To usunie wszystkie dzisiejsze zam√≥wienia i wyzeruje utarg. Kontynuowaƒá?")) {
            fetch(`${API}/reset-bazy`, { method: 'POST' })
                .then(r => r.json())
                .then(data => {
                    if(data.success) {
                        alert("Baza wyczyszczona! Powodzenia w nowym dniu!");
                        loadData();
                    }
                })
                .catch(() => alert("B≈ÇƒÖd! Sprawd≈∫ czy serwer na PC dzia≈Ça."));
        }
    }

    // Od≈õwie≈ºaj co 5 sekund
    setInterval(loadData, 5000);
    loadData();
</script>

</body>
</html>