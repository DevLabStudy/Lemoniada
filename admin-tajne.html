<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Centrum Dowodzenia üçã</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #FFD600; --success: #10b981; --danger: #ef4444; --accent: #38bdf8; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; }
        .box-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .box { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #334155; }
        .val { font-size: 2.5rem; font-weight: 900; color: var(--primary); display: block; }
        .pos-container { border: 2px solid var(--primary); padding: 20px; border-radius: 20px; }
        .cart-preview { background: #000; padding: 10px; border-radius: 10px; min-height: 40px; margin-bottom: 10px; cursor: pointer; }
        .btn-end { background: var(--danger); color: white; width: 100%; padding: 15px; border-radius: 15px; border: none; font-weight: 900; margin-bottom: 20px; cursor: pointer; }
        .btn-pos { padding: 15px; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; background: var(--primary); }
        input { background: transparent; border: 1px solid var(--accent); color: white; border-radius: 8px; padding: 5px; width: 60px; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Centrum Dowodzenia üçã</h1>
        <span id="status">‚óè SYSTEM ONLINE</span>
    </div>

    <div class="box-grid">
        <div class="box">
            <small>UTARG</small>
            <span class="val" id="rev">0.00 z≈Ç</span>
            <input type="number" id="workers" value="1" oninput="calc()"> <small id="split">Na g≈Çowƒô: 0 z≈Ç</small>
        </div>
        <div class="box">
            <small>MAGAZYN</small>
            <span class="val" id="cups">0</span>
            <input type="number" id="cups-in"> <button class="btn-pos" style="padding:5px 10px;" onclick="setCups()">USTAW</button>
        </div>
    </div>

    <button class="btn-end" onclick="endDay()">üèÅ ZAKO≈ÉCZ DZIE≈É</button>

    <div class="pos-container">
        <h3>üõí Szybka Sprzeda≈º</h3>
        <div id="cart" class="cart-preview" onclick="clearCart()">Koszyk jest pusty (kliknij by wyczy≈õciƒá)</div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
            <button class="btn-pos" onclick="add('Zwyk≈Ça', 5)">+ Zwyk≈Ça (5z≈Ç)</button>
            <button class="btn-pos" onclick="add('Pomara≈Ñcz', 7)">+ Pomara≈Ñcz (7z≈Ç)</button>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn-pos" style="background:var(--success); color:white; flex:2;" onclick="sale('Got√≥wka')">FINALIZUJ GOT√ìWKƒÑ</button>
            <button class="btn-pos" style="background:#3b82f6; color:white; flex:1;" onclick="sale('BLIK')">BLIK</button>
        </div>
    </div>
</div>

<script>
    const API = "https://api.lemoniada.com.pl";
    let utarg = 0; let cart = [];

    async function refresh() {
        const r = await fetch(`${API}/api/admin/data`);
        const d = await r.json();
        utarg = d.utarg;
        document.getElementById('rev').innerText = d.utarg.toFixed(2) + " z≈Ç";
        document.getElementById('cups').innerText = d.kubeczki;
        calc();
    }

    function calc() {
        const w = document.getElementById('workers').value || 1;
        document.getElementById('split').innerText = `Na g≈Çowƒô: ${(utarg/w).toFixed(2)} z≈Ç`;
    }

    function add(n, c) {
        let i = cart.find(x => x.nazwa === n);
        if(i) i.sztuk++; else cart.push({nazwa:n, cena:c, sztuk:1});
        render();
    }
    function render() {
        document.getElementById('cart').innerText = cart.length ? cart.map(x => `${x.nazwa} x${x.sztuk}`).join(', ') : "Koszyk jest pusty";
    }
    function clearCart() { cart = []; render(); }

    async function sale(p) {
        if(!cart.length) return;
        await fetch(`${API}/api/zamow`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ koszyk: cart, kod: '', platnosc: p }) });
        clearCart(); refresh();
    }

    async function setCups() {
        const v = document.getElementById('cups-in').value;
        await fetch(`${API}/api/admin/set-kubeczki`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ ilosc: v }) });
        refresh();
    }

    async function endDay() {
        if(!confirm("Reset?")) return;
        await fetch(`${API}/api/admin/reset`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ workers: document.getElementById('workers').value }) });
        refresh();
    }

    setInterval(refresh, 5000); refresh();
</script>
</body>
</html>