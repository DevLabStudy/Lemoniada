<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Admina - Lemoniada</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; padding: 15px; margin: 0; }
        .container { max-width: 500px; margin: auto; }
        .card { background: #2d2d2d; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #444; }
        .btn { padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .btn-sell { background: #27ae60; color: white; margin: 5px; flex: 1; padding: 15px; }
        .order { background: white; color: black; padding: 12px; border-radius: 10px; margin-bottom: 10px; border-left: 8px solid #ccc; }
        .status-btn { width: 100%; margin-top: 8px; padding: 10px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; }
        input { padding: 8px; border-radius: 5px; border: none; width: 60px; text-align: center; }
    </style>
</head>
<body>
<div class="container">
    <h2>üçã ZarzƒÖdzanie Stoiskiem</h2>

    <div class="card">
        <h4>üì¶ Magazyn: <span id="cups-count">0</span> kubk√≥w</h4>
        <input type="number" id="new-cups" value="50">
        <button class="btn" style="background:#f1c40f" onclick="updateCups()">USTAW</button>
    </div>

    <div class="card">
        <h4>‚ûï Szybka Sprzeda≈º (Na miejscu)</h4>
        <div style="display:flex;">
            <button class="btn btn-sell" onclick="quickSell('Klasyczna', 5)">üçã 5z≈Ç</button>
            <button class="btn btn-sell" onclick="quickSell('Pomara≈Ñczowa', 6.5)">üçä 6.5z≈Ç</button>
        </div>
    </div>

    <div class="card">
        <h4>üí∞ Utarg: <span id="total-money">0.00</span> z≈Ç</h4>
    </div>

    <h3>üìù Zam√≥wienia Online</h3>
    <div id="orders-list"></div>

    <button onclick="clearDay()" style="background:#e74c3c; color:white; width:100%; padding:15px; border:none; border-radius:10px; margin-top:30px; font-weight:bold;">üßπ KONIEC DNIA (RESET BAZY)</button>
</div>

<script>
    const API = "https://bacterial-concept-scripting-expired.trycloudflare.com";

    function updateCups() {
        const val = document.getElementById('new-cups').value;
        fetch(`${API}/ustaw-kubki`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ ilosc: val })
        }).then(() => load());
    }

    function quickSell(p, s) {
        fetch(`${API}/sprzedaz-stacjonarna`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ produkty: p, suma: s.toFixed(2) })
        }).then(() => load());
    }

    function load() {
        fetch(`${API}/stan-magazynu`).then(r=>r.json()).then(s=>document.getElementById('cups-count').innerText=s.kubki);
        fetch(`${API}/list-zamowienia`).then(r=>r.json()).then(data => {
            let utarg = 0;
            let html = "";
            data.forEach(z => {
                utarg += parseFloat(z.suma);
                if(z.platnosc === 'Got√≥wka (Stacjonarna)') return; // Nie pokazuj stacjonarnych na li≈õcie do wydania

                let button = "";
                let borderColor = "#ccc";

                if(z.status === 'PRZYJƒòTE') {
                    button = `<button class="status-btn" style="background:#3498db;color:white" onclick="changeStatus(${z.id},'W REALIZACJI')">ZACZNIJ ROBIƒÜ</button>`;
                    borderColor = "#f1c40f";
                } else if(z.status === 'W REALIZACJI') {
                    button = `<button class="status-btn" style="background:#f1c40f" onclick="changeStatus(${z.id},'DO ODBIORU')">GOTOWA (DO ODBIORU)</button>`;
                    borderColor = "#3498db";
                } else if(z.status === 'DO ODBIORU') {
                    button = `<button class="status-btn" style="background:#2ecc71;color:white" onclick="changeStatus(${z.id},'WYDANE')">WYDAJ KLIENTOWI</button>`;
                    borderColor = "#2ecc71";
                }

                html += `
                        <div class="order" style="border-left-color: ${borderColor}">
                            <b>#${z.id}</b> | ${z.godzina} | <b>${z.suma} z≈Ç</b><br>
                            <small>${z.produkty} (${z.platnosc})</small><br>
                            ${button || '<span style="color:green">Wydane ‚úì</span>'}
                        </div>`;
            });
            document.getElementById('total-money').innerText = utarg.toFixed(2);
            document.getElementById('orders-list').innerHTML = html;
        });
    }

    function changeStatus(id, st) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id, nowyStatus: st })
        }).then(() => load());
    }

    function clearDay() {
        if(confirm("Czy na pewno wyczy≈õciƒá ca≈Çy utarg i zam√≥wienia?")) {
            fetch(`${API}/reset-bazy`, { method: 'POST' }).then(() => load());
        }
    }

    setInterval(load, 5000);
    load();
</script>
</body>
</html>