<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Centrum Dowodzenia üçã</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #FFD600; --accent: #38bdf8; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }

        /* Staty i Magazyn */
        .header-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .box { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid #334155; position: relative; }
        .val { font-size: 2.5rem; font-weight: 900; color: var(--primary); display: block; }
        .label { font-size: 0.8rem; text-transform: uppercase; opacity: 0.6; letter-spacing: 1px; }

        /* Poprawiony przycisk kubeczk√≥w */
        .cups-input-group { display: flex; gap: 8px; margin-top: 15px; }
        .cups-input-group input { background: #0f172a; border: 1px solid var(--accent); color: white; padding: 10px; border-radius: 10px; width: 80px; font-size: 1.1rem; }
        .btn-set { background: var(--accent); color: #000; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .btn-set:hover { transform: scale(1.05); filter: brightness(1.1); }

        /* Koszyk Admina z usuwaniem */
        .pos-card { background: var(--card); border: 2px solid var(--primary); padding: 20px; border-radius: 24px; margin-bottom: 30px; }
        .cart-items-admin { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; margin-bottom: 15px; min-height: 40px; }
        .admin-cart-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; border-bottom: 1px solid #334155; padding-bottom: 5px; }
        .btn-del { background: #ef4444; color: white; border: none; width: 24px; height: 24px; border-radius: 6px; cursor: pointer; font-size: 12px; }

        /* Przyciski akcji */
        .action-btns { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .btn-main { padding: 15px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-yellow { background: var(--primary); color: #000; }
        .btn-green { background: #10b981; color: white; }
        .btn-blue { background: #3b82f6; color: white; }

        .order-card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--primary); }
        #status-top { float: right; font-size: 0.8rem; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div id="status-top" style="color:#ef4444">‚óè SYSTEM ROZ≈ÅƒÑCZONY</div>
    <h1>Admin Lemoniada üçã</h1>

    <div class="header-grid">
        <div class="box">
            <span class="label">Aktualny Utarg</span>
            <span class="val" id="rev-val">0.00 z≈Ç</span>
        </div>
        <div class="box">
            <span class="label">Kubeczki w Magazynie</span>
            <span class="val" id="cups-val">0</span>
            <div class="cups-input-group">
                <input type="number" id="cups-num" placeholder="Ile?">
                <button class="btn-set" onclick="setCups()">USTAW ZAPAS</button>
            </div>
        </div>
    </div>

    <div class="pos-card">
        <h3>üõí Szybka Sprzeda≈º Stacjonarna</h3>
        <div id="admin-cart-list" class="cart-items-admin">Koszyk jest pusty</div>

        <div class="action-btns" style="margin-bottom:15px">
            <button class="btn-main btn-yellow" onclick="addStac('Zwyk≈Ça', 5)">+ Zwyk≈Ça (5z≈Ç)</button>
            <button class="btn-main btn-yellow" onclick="addStac('Pomara≈Ñcz', 7)">+ Pomara≈Ñcz (7z≈Ç)</button>
        </div>

        <div class="action-btns">
            <button class="btn-main btn-green" onclick="finalize('Got√≥wka')">FINALIZUJ GOT√ìWKƒÑ</button>
            <button class="btn-main btn-blue" onclick="finalize('BLIK')">FINALIZUJ BLIK</button>
        </div>
    </div>

    <h2>Aktywne Zam√≥wienia</h2>
    <div id="order-list"></div>
</div>

<script>
    const API = "https://api.lemoniada.com.pl";
    let adminCart = [];

    async function load() {
        try {
            const r = await fetch(`${API}/api/admin/data`);
            if(!r.ok) throw new Error();
            const d = await r.json();

            document.getElementById('status-top').innerText = "‚óè SYSTEM ONLINE";
            document.getElementById('status-top').style.color = "#10b981";
            document.getElementById('rev-val').innerText = d.utarg.toFixed(2) + " z≈Ç";
            document.getElementById('cups-val').innerText = d.kubeczki;

            let html = '';
            d.zamowienia.filter(o => o.status !== 'zrealizowane').forEach(o => {
                html += `<div class="order-card">
                    <div><b>#${o.id}</b><br><small>${o.produkty}</small><br><b>${o.cena_total} z≈Ç</b> (${o.platnosc})</div>
                    <div>
                        <button class="btn-main btn-yellow" style="padding:8px" onclick="updateSt('${o.id}','gotowe')">GOTOWE</button>
                        <button class="btn-main btn-green" style="padding:8px" onclick="updateSt('${o.id}','zrealizowane')">ZAKO≈ÉCZ</button>
                    </div>
                </div>`;
            });
            document.getElementById('order-list').innerHTML = html || "Brak zam√≥wie≈Ñ";
        } catch(e) {
            document.getElementById('status-top').innerText = "‚óè B≈ÅƒÑD PO≈ÅƒÑCZENIA (Sprawd≈∫ terminal!)";
            document.getElementById('status-top').style.color = "#ef4444";
        }
    }

    function addStac(nazwa, cena) {
        let item = adminCart.find(i => i.nazwa === nazwa);
        if(item) item.sztuk++; else adminCart.push({nazwa, cena, sztuk: 1});
        renderAdminCart();
    }

    function removeStac(nazwa) {
        let item = adminCart.find(i => i.nazwa === nazwa);
        if(item) {
            item.sztuk--;
            if(item.sztuk <= 0) adminCart = adminCart.filter(i => i.nazwa !== nazwa);
        }
        renderAdminCart();
    }

    function renderAdminCart() {
        const list = document.getElementById('admin-cart-list');
        if(adminCart.length === 0) { list.innerHTML = "Koszyk jest pusty"; return; }
        list.innerHTML = adminCart.map(i => `
            <div class="admin-cart-row">
                <span>${i.nazwa} x${i.sztuk}</span>
                <button class="btn-del" onclick="removeStac('${i.nazwa}')">‚úï</button>
            </div>
        `).join('');
    }

    async function setCups() {
        const ilosc = document.getElementById('cups-num').value;
        if(!ilosc) return alert("Wpisz liczbƒô!");
        const res = await fetch(`${API}/api/admin/set-kubeczki`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ ilosc: parseInt(ilosc) })
        });
        if(res.ok) { alert("Zapas zaktualizowany!"); load(); }
    }

    async function finalize(platnosc) {
        if(adminCart.length === 0) return alert("Koszyk jest pusty!");
        await fetch(`${API}/api/zamow`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ koszyk: adminCart, kod: '', platnosc })
        });
        adminCart = []; renderAdminCart(); load();
    }

    async function updateSt(id, status) {
        await fetch(`${API}/api/admin/status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id, status })
        });
        load();
    }

    setInterval(load, 4000); load();
</script>
</body>
</html>