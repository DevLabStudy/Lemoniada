<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Szefa</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="background:#1a1a1a; color:white;">
<div class="app-container">
    <h2>ğŸ’° Utarg: <span id="suma" style="color:#2ecc71">0</span> zÅ‚</h2>
    <button onclick="clearOrders()" style="background:#c0392b; font-size:10px; margin-bottom:15px;">WyczyÅ›Ä‡ listÄ™ (Koniec dnia)</button>
    <div id="admin-list"></div>
</div>
<audio id="bell" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>

<script>
    const API = "https://ensemble-seafood-wiki-richard.trycloudflare.com";

    function load() {
        fetch(`${API}/list-zamowienia`).then(r => r.json()).then(data => {
            const list = document.getElementById('admin-list');
            let utarg = 0;
            list.innerHTML = "";
            data.forEach(z => {
                utarg += parseFloat(z.suma);
                list.innerHTML += `
                    <div class="card" style="color:black; margin-bottom:10px; text-align:left;">
                        <p><b>${z.godzina}</b> | ID: ${z.id}</p>
                        <p>ğŸ“¦ ${z.produkty}</p>
                        <p>ğŸ’° ${z.suma} zÅ‚ | <b>${z.platnosc}</b></p>
                        <p>Status: ${z.status}</p>
                        <button onclick="setStatus(${z.id}, 'W PRODUKCJI')" style="background:orange">RobiÄ™</button>
                        <button onclick="setStatus(${z.id}, 'GOTOWE')" style="background:green">Gotowe</button>
                    </div>`;
            });
            document.getElementById('suma').innerText = utarg.toFixed(2);
        });
    }

    function setStatus(id, s) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id, nowyStatus: s})
        }).then(() => {
            if(s === 'GOTOWE') document.getElementById('bell').play();
            load();
        });
    }

    function clearOrders() {
        if(confirm("Czy na pewno wyczyÅ›ciÄ‡ wszystkie zamÃ³wienia?")) {
            fetch(`${API}/clear-all`, {method:'POST'}).then(() => load());
        }
    }

    setInterval(load, 4000);
    load();
</script>
</body>
</html>