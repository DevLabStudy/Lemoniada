<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Szefa - Lemoniada</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: white; padding: 15px; margin: 0; }
        .container { max-width: 600px; margin: auto; }
        .card { background: #2d2d2d; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #444; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        h2, h3 { color: #f1c40f; margin-top: 0; }

        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }

        .btn-toggle { width: 48%; padding: 15px; margin: 5px 1%; border-radius: 10px; font-weight: bold; border: none; cursor: pointer; }
        .on { background: #27ae60; color: white; }
        .off { background: #e74c3c; color: white; }

        .btn-sell { background: #2ecc71; color: white; width: 48%; margin: 5px 1%; }

        .order { background: white; color: black; padding: 15px; border-radius: 12px; margin-bottom: 12px; border-left: 10px solid #ccc; position: relative; }
        .status-btn { width: 100%; margin-top: 10px; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 14px; }

        input[type="number"] { padding: 10px; border-radius: 8px; border: none; width: 70px; font-size: 16px; text-align: center; }
        .stats-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .money-text { font-size: 20px; color: #2ecc71; font-weight: bold; }
    </style>
</head>
<body>
<div class="container">
    <h2>üçã Panel Sterowania</h2>

    <div class="card" style="text-align: center;">
        <h3 style="font-size: 16px; color: #bbb;">ZARZƒÑDZANIE DOSTƒòPNO≈öCIƒÑ</h3>
        <button id="p-btn" class="btn-toggle on" onclick="togglePause()">STREFA: OTWARTA</button>
        <button id="c-btn" class="btn-toggle on" onclick="toggleCupsStatus()">KUBKI: SƒÑ</button>
    </div>

    <div class="card">
        <div class="stats-box">
            <div>Kubki: <b id="cups-count">0</b></div>
            <div class="money-text"><span id="total-money">0.00</span> z≈Ç</div>
        </div>
        <div style="margin-bottom: 15px;">
            <input type="number" id="new-cups" placeholder="50">
            <button class="btn" style="background:#f1c40f" onclick="updateCups()">USTAW MAGAZYN</button>
        </div>
        <hr style="opacity: 0.1;">
        <p style="margin: 10px 0; font-weight: bold; text-align: center;">SZYBKA SPRZEDA≈ª STACJONARNA:</p>
        <div style="display: flex; justify-content: center;">
            <button class="btn btn-sell" onclick="quickSell('Klasyczna', 5.00)">üçã KLASYK 5z≈Ç</button>
            <button class="btn btn-sell" onclick="quickSell('Pomara≈Ñczowa', 6.50)">üçä POMARA≈ÉCZ 6.5z≈Ç</button>
        </div>
    </div>

    <h3>üìù Aktywne Zam√≥wienia Online</h3>
    <div id="orders-list">Wczytywanie...</div>

    <button onclick="clearDay()" style="background:#e74c3c; color:white; width:100%; padding:18px; border:none; border-radius:12px; margin-top:30px; font-weight:bold; font-size: 16px;">üßπ KONIEC DNIA (RESET BAZY)</button>
</div>

<script>
    const API = "https://bacterial-concept-scripting-expired.trycloudflare.com";
    let isPaused = false;
    let noCups = false;

    function togglePause() {
        isPaused = !isPaused;
        const btn = document.getElementById('p-btn');
        btn.innerText = isPaused ? "PRZERWA" : "STREFA: OTWARTA";
        btn.className = `btn-toggle ${isPaused ? 'off' : 'on'}`;
        sendSystemStatus();
    }

    function toggleCupsStatus() {
        noCups = !noCups;
        const btn = document.getElementById('c-btn');
        btn.innerText = noCups ? "BRAK KUBK√ìW" : "KUBKI: SƒÑ";
        btn.className = `btn-toggle ${noCups ? 'off' : 'on'}`;
        sendSystemStatus();
    }

    function sendSystemStatus() {
        fetch(`${API}/ustaw-przerwe`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                przerwa: isPaused || noCups,
                powod: noCups ? "Brak kubk√≥w! Zaraz wracamy." : "Zaraz wracamy! Chwila przerwy."
            })
        });
    }

    function updateCups() {
        const val = document.getElementById('new-cups').value;
        fetch(`${API}/ustaw-kubki`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ ilosc: val })
        }).then(() => loadData());
    }

    function quickSell(p, s) {
        fetch(`${API}/sprzedaz-stacjonarna`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ produkty: p, suma: s.toFixed(2) })
        }).then(() => loadData());
    }

    function loadData() {
        fetch(`${API}/stan-magazynu`).then(r=>r.json()).then(s => {
            document.getElementById('cups-count').innerText = s.kubki;
        });

        fetch(`${API}/list-zamowienia`).then(r=>r.json()).then(data => {
            let utarg = 0;
            let html = "";
            data.forEach(z => {
                utarg += parseFloat(z.suma);
                if(z.platnosc.includes("Stacjonarna")) return;

                let btnHtml = "";
                let borderColor = "#ccc";

                if(z.status === 'PRZYJƒòTE') {
                    btnHtml = `<button class="status-btn" style="background:#3498db;color:white" onclick="changeStatus(${z.id},'W REALIZACJI')">ROZPOCZNIJ ROBIENIE</button>`;
                    borderColor = "#f1c40f";
                } else if(z.status === 'W REALIZACJI') {
                    btnHtml = `<button class="status-btn" style="background:#f1c40f" onclick="changeStatus(${z.id},'DO ODBIORU')">GOTOWA - DO ODBIORU</button>`;
                    borderColor = "#3498db";
                } else if(z.status === 'DO ODBIORU') {
                    btnHtml = `<button class="status-btn" style="background:#2ecc71;color:white" onclick="changeStatus(${z.id},'WYDANE')">POTWIERD≈π WYDANIE</button>`;
                    borderColor = "#2ecc71";
                }

                html += `
                        <div class="order" style="border-left-color: ${borderColor}">
                            <b>#${z.id}</b> | ${z.godzina} | <b>${z.suma} z≈Ç</b><br>
                            <small>${z.produkty} (${z.platnosc})</small><br>
                            ${btnHtml || '<span style="color:green; font-weight:bold;">ZREALIZOWANO ‚úì</span>'}
                        </div>`;
            });
            document.getElementById('total-money').innerText = utarg.toFixed(2);
            document.getElementById('orders-list').innerHTML = html || "<p style='color:gray;'>Brak nowych zam√≥wie≈Ñ.</p>";
        });
    }

    function changeStatus(id, st) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id, nowyStatus: st })
        }).then(() => loadData());
    }

    function clearDay() {
        if(confirm("ZRESETOWAƒÜ CA≈ÅY DZIE≈É? Wszystkie zam√≥wienia zniknƒÖ!")) {
            fetch(`${API}/reset-bazy`, { method: 'POST' }).then(() => loadData());
        }
    }

    setInterval(loadData, 4000);
    loadData();
</script>
</body>
</html>