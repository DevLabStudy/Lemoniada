<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Szefa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body style="background:#121212; color:white; font-family:sans-serif;">
<div style="padding: 20px; max-width: 600px; margin: auto;">

    <div style="background:#f1c40f; color:black; padding:15px; border-radius:15px; margin-bottom:20px;">
        <h3>üì¶ Magazyn: <span id="kubki-licznik">0</span> kubk√≥w</h3>
        <input type="number" id="nowa-ilosc" style="width:60px; padding:8px;">
        <button onclick="ustawKubki()" style="background:black; color:white; padding:8px;">Ustaw</button>
        <button id="btn-przerwa" onclick="togglePrzerwa()" style="background:#d35400; color:white; padding:8px; display:block; width:100%; margin-top:10px; font-weight:bold;"></button>
    </div>

    <div style="background:#2c3e50; padding:15px; border-radius:15px; margin-bottom:20px;">
        <h4>‚ûï Sprzeda≈º stacjonarna</h4>
        <button onclick="sprzedazReczna(5)" style="background:#2ecc71; color:white; padding:10px; width:48%;">Klasyk 5z≈Ç</button>
        <button onclick="sprzedazReczna(6.5)" style="background:#2ecc71; color:white; padding:10px; width:48%;">Pomara≈Ñcz 6.5z≈Ç</button>
    </div>

    <h2>üí∞ Utarg: <span id="suma-dnia">0.00</span> z≈Ç</h2>
    <div id="list"></div>
</div>

<script>
    const API = "https://bacterial-concept-scripting-expired.trycloudflare.com";

    function ustawKubki() {
        const ilosc = document.getElementById('nowa-ilosc').value;
        fetch(`${API}/ustaw-kubki`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ ilosc })
        }).then(() => load());
    }

    function togglePrzerwa() {
        fetch(`${API}/toggle-dostawa`, { method: 'POST' }).then(() => load());
    }

    function sprzedazReczna(suma) {
        fetch(`${API}/sprzedaz-reczna`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ suma: suma.toFixed(2) })
        }).then(() => load());
    }

    function load() {
        fetch(`${API}/stan-magazynu`).then(r => r.json()).then(stan => {
            document.getElementById('kubki-licznik').innerText = stan.kubki;
            document.getElementById('btn-przerwa').innerText = stan.przerwa ? "WZN√ìW SPRZEDA≈ª" : "IDƒò PO WIƒòCEJ (PAUZA)";
        }).catch(e => console.log("B≈ÇƒÖd po≈ÇƒÖczenia z serwerem"));

        fetch(`${API}/list-zamowienia`).then(r => r.json()).then(data => {
            const l = document.getElementById('list');
            let total = 0;
            l.innerHTML = "";
            data.forEach(z => {
                total += parseFloat(z.suma);
                l.innerHTML += `
                    <div style="background:white; color:black; padding:10px; border-radius:10px; margin-bottom:10px; border-left:10px solid ${z.status==='GOTOWE'?'#2ecc71':'#3498db'}">
                        <small>${z.godzina} | ID: ${z.id} | ${z.platnosc}</small>
                        <p><b>${z.produkty}</b> - ${z.suma} z≈Ç</p>
                        <b>Status: ${z.status}</b><br>
                        <button onclick="upd(${z.id}, 'REALIZUJEMY')" style="background:#3498db; color:white;">Realizuj</button>
                        <button onclick="upd(${z.id}, 'GOTOWE')" style="background:#2ecc71; color:white;">Gotowe</button>
                    </div>`;
            });
            document.getElementById('suma-dnia').innerText = total.toFixed(2);
        });
    }

    function upd(id, nowyStatus) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id, nowyStatus })
        }).then(() => load());
    }

    setInterval(load, 5000);
    load();
</script>
</body>
</html>