<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="background: #222;">
<div class="app-container">
    <h2>Panel <span>Produkcji</span></h2>
    <div id="admin-list"></div>
</div>

<audio id="bell" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>

<script>
    const API = "https://ensemble-seafood-wiki-richard.trycloudflare.com";

    function updateStatus(id, status) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id: id, nowyStatus: status })
        }).then(() => {
            if(status === 'GOTOWE') document.getElementById('bell').play();
            loadOrders();
        });
    }

    function loadOrders() {
        fetch(`${API}/list-zamowienia`)
            .then(r => r.json())
            .then(data => {
                const div = document.getElementById('admin-list');
                div.innerHTML = "";
                data.filter(z => z.status !== 'ODEBRANE').forEach(z => {
                    div.innerHTML += `
                    <div class="card" style="margin-bottom: 10px;">
                        <p>${z.godzina} - <b>${z.produkt}</b></p>
                        <button onclick="updateStatus(${z.id}, 'W PRODUKCJI')" style="background: orange">RobiÄ™</button>
                        <button onclick="updateStatus(${z.id}, 'GOTOWE')" style="background: green; margin-top:5px">Gotowe!</button>
                    </div>`;
                });
            });
    }
    setInterval(loadOrders, 4000);
    loadOrders();
</script>
</body>
</html>