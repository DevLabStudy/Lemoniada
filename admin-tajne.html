<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>POS Admin</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="background:#1a1a1a; color:white;">
<div class="app-container" style="max-width:500px;">
    <div class="card" style="color:black; margin-bottom:15px; background:#f1c40f;">
        <h3>ðŸ“¦ Kubki: <span id="kubki-licznik">0</span></h3>
        <input type="number" id="nowa-ilosc" style="width:50px;">
        <button onclick="ustawKubki()" style="width:auto; background:#333;">Ustaw</button>
        <button id="btn-przerwa" onclick="togglePrzerwa()" style="background:#e67e22; margin-top:5px;">IdÄ™ po wiÄ™cej</button>
    </div>

    <div class="card" style="color:black; margin-bottom:15px;">
        <h4>âž• SprzedaÅ¼ RÄ™czna</h4>
        <button onclick="sprzedazReczna(5)" style="background:#2ecc71; width:45%;">Klasyk (5zÅ‚)</button>
        <button onclick="sprzedazReczna(6.5)" style="background:#2ecc71; width:45%;">PomaraÅ„cz (6.5zÅ‚)</button>
    </div>

    <h2>Utarg: <span id="suma-dnia">0</span> zÅ‚</h2>
    <div id="list"></div>
</div>

<script>
    const API = "TU_WKLEJ_LINK_Z_CLOUDFLARE";

    function ustawKubki() {
        const ilosc = document.getElementById('nowa-ilosc').value;
        fetch(`${API}/ustaw-kubki`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ ilosc })
        }).then(() => load());
    }

    function togglePrzerwa() {
        fetch(`${API}/toggle-dostawa`, { method: 'POST' }).then(() => load());
    }

    function sprzedazReczna(cena) {
        fetch(`${API}/sprzedaz-reczna`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ suma: cena.toFixed(2) })
        }).then(() => load());
    }

    function load() {
        // Stan magazynu
        fetch(`${API}/stan-magazynu`).then(r => r.json()).then(stan => {
            document.getElementById('kubki-licznik').innerText = stan.kubki;
            document.getElementById('btn-przerwa').innerText = stan.przerwa ? "WZNAWIAJ" : "IDÄ˜ PO WIÄ˜CEJ";
        });

        // Lista zamÃ³wieÅ„
        fetch(`${API}/list-zamowienia`).then(r => r.json()).then(data => {
            const l = document.getElementById('list');
            let total = 0; l.innerHTML = "";
            data.forEach(z => {
                total += parseFloat(z.suma);
                l.innerHTML += `
                    <div class="card" style="color:black; border-left: 10px solid ${z.status==='GOTOWE'?'#2ecc71':'#3498db'}">
                        <small>${z.godzina} | ${z.platnosc}</small>
                        <p><b>${z.produkty}</b> - ${z.suma} zÅ‚</p>
                        <button onclick="upd(${z.id}, 'REALIZUJEMY')">W trakcie</button>
                        <button onclick="upd(${z.id}, 'GOTOWE')" style="background:green">Gotowe</button>
                    </div>`;
            });
            document.getElementById('suma-dnia').innerText = total.toFixed(2);
        });
    }

    function upd(id, s) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id, nowyStatus: s })
        }).then(() => load());
    }

    setInterval(load, 5000);
    load();
</script>
</body>
</html>