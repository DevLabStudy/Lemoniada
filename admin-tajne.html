<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>ADMIN </title>
    <style>
        body { font-family: sans-serif; background: #eee; padding: 20px; }
        .card { background: white; padding: 15px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .utarg-box { font-size: 2rem; font-weight: bold; color: #2ecc71; text-align: center; margin-bottom: 30px; }
        .status-btn { padding: 8px; margin-right: 5px; cursor: pointer; border: none; border-radius: 5px; }
        .status-przyjte { background: #3498db; color: white; }
        .status-realizacja { background: #f1c40f; }
        .status-gotowe { background: #e67e22; color: white; }
        .status-koniec { background: #2ecc71; color: white; }
    </style>
</head>
<body>
    <h1>Panel Admina Lemoniada </h1>
    <div class="card">
        <h3>SUMA ZAROBIONA:</h3>
        <div id="utarg" class="utarg-box">0.00 PLN</div>
    </div>

    <h3>Aktywne zam贸wienia:</h3>
    <div id="lista-zamowien">Wczytywanie...</div>

    <script>
        const API = "https://api.lemoniada.com.pl";

        async function odswiez() {
            const r = await fetch(`${API}/api/admin/all`);
            const db = await r.json();

            document.getElementById('utarg').innerText = db.utarg.toFixed(2) + " PLN";

            let html = '';
            // Pokazujemy tylko zam贸wienia, kt贸re nie s jeszcze cakowicie zakoczone (lub wszystkie)
            Object.values(db.zamowienia).reverse().forEach(o => {
                if(o.status === 'zrealizowane') return; // Nie pokazuj zakoczonych
                html += `
                <div class="card">
                    <strong>Zam贸wienie #${o.id}</strong> - ${o.rodzaj} (${o.cena} z) [${o.platnosc}]<br>
                    Status: <b>${o.status.toUpperCase()}</b><br><br>
                    <button class="status-btn status-przyjte" onclick="update('${o.id}', 'przyjte')">Przyjmij</button>
                    <button class="status-btn status-realizacja" onclick="update('${o.id}', 'w realizacji')">W realizacji</button>
                    <button class="status-btn status-gotowe" onclick="update('${o.id}', 'gotowe')">GOTOWE</button>
                    <button class="status-btn status-koniec" onclick="update('${o.id}', 'zrealizowane')">ZAKOCZ (Dolicz $)</button>
                </div>`;
            });
            document.getElementById('lista-zamowien').innerHTML = html || 'Brak nowych zam贸wie.';
        }

        async function update(id, st) {
            await fetch(`${API}/api/admin/status`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id, nowyStatus: st })
            });
            odswiez();
        }

        setInterval(odswiez, 3000);
        odswiez();
    </script>
</body>
</html>