<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Admin POS</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="background: #222; color: white;">
<div class="app-container">
    <h2>ðŸ’° Razem: <span id="utarg" style="color: #2ecc71">0</span> zÅ‚</h2>
    <div id="admin-list"></div>
</div>
<audio id="bell" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>

<script>
    const API = "https://ensemble-seafood-wiki-richard.trycloudflare.com";

    function loadOrders() {
        fetch(`${API}/list-zamowienia`).then(r => r.json()).then(data => {
            const div = document.getElementById('admin-list');
            let sumaCalkowita = 0;
            div.innerHTML = "";

            data.forEach(z => {
                sumaCalkowita += parseFloat(z.suma);
                div.innerHTML += `
                    <div class="card" style="color: black; text-align: left; margin-bottom: 15px;">
                        <small>${z.godzina} | ID: ${z.id}</small>
                        <p><b>Produkty:</b> ${z.produkty}</p>
                        <p><b>Kwota:</b> ${z.suma} zÅ‚ (${z.platnosc})</p>
                        <p>Status: ${z.status}</p>
                        <button onclick="updateStatus(${z.id}, 'W PRODUKCJI')" style="background: orange">RobiÄ™</button>
                        <button onclick="updateStatus(${z.id}, 'GOTOWE')" style="background: green">Gotowe</button>
                    </div>`;
            });
            document.getElementById('utarg').innerText = sumaCalkowita.toFixed(2);
        });
    }

    function updateStatus(id, s) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id, nowyStatus: s})
        }).then(() => {
            if(s === 'GOTOWE') document.getElementById('bell').play();
            loadOrders();
        });
    }

    setInterval(loadOrders, 4000);
    loadOrders();
</script>
</body>
</html>