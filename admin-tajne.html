<script>
    const API = "https://ensemble-seafood-wiki-richard.trycloudflare.com";

    function load() {
        fetch(`${API}/list-zamowienia`).then(r => r.json()).then(data => {
            const list = document.getElementById('admin-list');
            let total = 0;
            list.innerHTML = "";
            data.forEach(z => {
                total += parseFloat(z.suma);
                list.innerHTML += `
                <div class="card" style="color:black; margin-bottom:10px; text-align:left; border-left: 8px solid ${z.status === 'GOTOWE' ? '#2ecc71' : (z.status === 'REALIZUJEMY' ? '#17a2b8' : '#f1c40f')}">
                    <p><small>${z.godzina} | ID: ${z.id}</small></p>
                    <p><b>${z.produkty}</b></p>
                    <p>${z.suma} zł | ${z.platnosc}</p>
                    <p>Status: <b>${z.status}</b></p>
                    <div style="display:flex; gap:5px;">
                        <button onclick="updateStatus(${z.id}, 'REALIZUJEMY')" style="background:#17a2b8">Realizujemy</button>
                        <button onclick="updateStatus(${z.id}, 'GOTOWE')" style="background:#28a745">Gotowe</button>
                    </div>
                </div>`;
            });
            document.getElementById('suma').innerText = total.toFixed(2);
        });
    }

    function updateStatus(id, s) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id, nowyStatus: s})
        }).then(() => load());
    }

    // Odświeżanie co 4 sekundy, bez dźwięku
    setInterval(load, 4000);
    load();
</script>