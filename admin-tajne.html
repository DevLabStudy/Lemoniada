<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Szef - Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; padding: 10px; margin: 0; }
        .card { background: #2d2d2d; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #444; }
        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; width: 100%; }
        .on { background: #27ae60; color: white; }
        .off { background: #e74c3c; color: white; }
        .order { background: white; color: black; padding: 12px; border-radius: 10px; margin-bottom: 10px; border-left: 8px solid #ccc; }
        .status-btn { width: 100%; margin-top: 10px; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        input { padding: 10px; border-radius: 8px; border: none; width: 80px; font-size: 16px; }
        #connection-status { color: #e74c3c; font-weight: bold; text-align: center; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>
<div style="max-width: 500px; margin: auto;">
    <h2 style="text-align:center; color:#f1c40f">üçã ZarzƒÖdzanie</h2>

    <div id="connection-status">‚ö†Ô∏è BRAK PO≈ÅƒÑCZENIA Z SERWEREM!</div>

    <div class="card">
        <button id="p-btn" class="btn on" onclick="tglP()">STATUS: OTWARTE</button>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
            <span>Kubki: <b id="c-count">0</b></span>
            <span style="color:#2ecc71">Utarg: <b id="money">0</b> z≈Ç</span>
        </div>
        <div style="display:flex; gap:10px;">
            <input type="number" id="n-cups" placeholder="Ilo≈õƒá">
            <button class="btn on" onclick="set()">USTAW KUBKI</button>
        </div>
        <hr style="opacity:0.1; margin:15px 0;">
        <div style="display:flex; gap:10px;">
            <button class="btn" style="background:#f1c40f; color:black" onclick="qs('Klasyczna', 5)">+ Klasyczna</button>
            <button class="btn" style="background:#f39c12; color:white" onclick="qs('Pomara≈Ñczowa', 6.5)">+ Pomara≈Ñczowy</button>
        </div>
    </div>

    <h3>Zam√≥wienia:</h3>
    <div id="list"></div>

    <button onclick="reset()" style="background:#c0392b; color:white; width:100%; padding:15px; border:none; border-radius:10px; margin-top:20px; font-weight:bold;">RESETUJ WSZYSTKO</button>
</div>

<script>
    // TUTAJ WKLEJ AKTUALNY LINK Z CLOUDFLARE
    const API = "https://bacterial-concept-scripting-expired.trycloudflare.com";

    let isPause = false;

    function tglP() {
        isPause = !isPause;
        const b = document.getElementById('p-btn');
        b.className = `btn ${isPause ? 'off' : 'on'}`;
        b.innerText = isPause ? 'STATUS: PRZERWA' : 'STATUS: OTWARTE';

        fetch(`${API}/ustaw-przerwe`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ przerwa: isPause, powod: "Zaraz wracamy!" })
        }).catch(err => showErr());
    }

    function set() {
        const val = document.getElementById('n-cups').value;
        fetch(`${API}/ustaw-kubki`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ ilosc: val })
        }).then(() => load()).catch(err => showErr());
    }

    function qs(prod, cena) {
        fetch(`${API}/sprzedaz-stacjonarna`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ produkty: prod, suma: cena.toFixed(2) })
        }).then(() => load()).catch(err => showErr());
    }

    function load() {
        fetch(`${API}/stan-magazynu`).then(r => r.json()).then(s => {
            document.getElementById('c-count').innerText = s.kubki;
            document.getElementById('connection-status').style.display = 'none';
        }).catch(() => showErr());

        fetch(`${API}/list-zamowienia`).then(r => r.json()).then(data => {
            let m = 0, h = "";
            data.forEach(z => {
                m += parseFloat(z.suma);
                if(z.platnosc.includes("Stacjonarna")) return;
                let btn = "", col = "#f1c40f";
                if(z.status === 'PRZYJƒòTE') btn = `<button class="status-btn" style="background:#3498db;color:white" onclick="upd(${z.id},'W REALIZACJI')">ROZPOCZNIJ</button>`;
                else if(z.status === 'W REALIZACJI') { btn = `<button class="status-btn" style="background:#f1c40f" onclick="upd(${z.id},'DO ODBIORU')">GOTOWA</button>`; col="#3498db"; }
                else if(z.status === 'DO ODBIORU') { btn = `<button class="status-btn" style="background:#2ecc71;color:white" onclick="upd(${z.id},'WYDANE')">WYDAJ</button>`; col="#2ecc71"; }
                h += `<div class="order" style="border-left:8px solid ${col}"><b>#${z.id}</b> | ${z.suma}z≈Ç | <b>${z.platnosc}</b><br><small>${z.produkty}</small><br>${btn}</div>`;
            });
            document.getElementById('money').innerText = m.toFixed(2);
            document.getElementById('list').innerHTML = h || "Brak zam√≥wie≈Ñ";
        });
    }

    function upd(id, status) {
        fetch(`${API}/update-status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id, nowyStatus: status })
        }).then(() => load());
    }

    function reset() { if(confirm("Na pewno wyczy≈õciƒá dane?")) fetch(`${API}/reset-bazy`, {method:'POST'}).then(() => load()); }
    function showErr() { document.getElementById('connection-status').style.display = 'block'; }

    setInterval(load, 3000);
    load();
</script>
</body>
</html>