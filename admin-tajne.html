<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard üçã</title>
    <style>
        :root { --primary: #FFD600; --success: #2ecc71; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }

        /* Statystyki na g√≥rze */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .stat-value { font-size: 2rem; font-weight: 800; color: var(--primary); }
        .stat-label { font-size: 0.8rem; opacity: 0.7; text-transform: uppercase; }

        /* Lista zam√≥wie≈Ñ */
        .orders-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .order-card { background: var(--card); border-radius: 16px; padding: 15px; border-left: 5px solid var(--primary); position: relative; }
        .order-id { position: absolute; top: 15px; right: 15px; font-size: 0.8rem; opacity: 0.5; }
        .order-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 5px; }
        .order-info { font-size: 0.9rem; margin-bottom: 15px; opacity: 0.9; }

        /* Przyciski status√≥w */
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.8rem; transition: 0.2s; }
        .btn-work { background: #334155; color: white; }
        .btn-ready { background: #f59e0b; color: white; }
        .btn-done { background: var(--success); color: white; grid-column: span 2; margin-top: 5px; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }

        /* Kalkulator */
        .calc-section { background: var(--card); padding: 20px; border-radius: 20px; margin-top: 40px; border: 1px dashed rgba(255,255,255,0.2); }
        input { background: #0f172a; border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; width: 60px; text-align: center; font-size: 1.1rem; }
        .split-result { color: var(--success); font-weight: 800; font-size: 1.2rem; }
    </style>
</head>
<body>

<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1 style="margin:0;">Dashboard üçã</h1>
        <div id="clock" style="opacity: 0.5;"></div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Ca≈Çkowity Utarg</div>
            <div class="stat-value" id="total-revenue">0.00 z≈Ç</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Aktywne zam√≥wienia</div>
            <div class="stat-value" id="active-count">0</div>
        </div>
    </div>

    <h2 style="font-size: 1rem; opacity: 0.6; margin-bottom: 15px;">AKTYWNE ZAM√ìWIENIA</h2>
    <div id="orders-list" class="orders-grid">
        </div>

    <div class="calc-section">
        <h3>üí∞ Rozliczenie pracownik√≥w</h3>
        <p>Podziel utarg na <input type="number" id="emp-count" value="1" oninput="calcSplit()"> osoby/os√≥b.</p>
        <div class="split-result">Dla ka≈ºdego: <span id="split-value">0.00</span> z≈Ç</div>
    </div>
</div>

<script>
    const API = "https://api.lemoniada.com.pl";
    let currentRevenue = 0;

    async function fetchData() {
        try {
            const r = await fetch(`${API}/api/admin/data`);
            const d = await r.json();

            currentRevenue = d.utarg;
            document.getElementById('total-revenue').innerText = d.utarg.toFixed(2) + " z≈Ç";
            document.getElementById('active-count').innerText = d.zamowienia.length;

            let html = '';
            d.zamowienia.reverse().forEach(o => {
                const statusClass = o.status === 'gotowe' ? 'style="border-left-color:#f59e0b"' : '';
                html += `
                    <div class="order-card" ${statusClass}>
                        <div class="order-id">#${o.id}</div>
                        <div class="order-title">${o.produkt}</div>
                        <div class="order-info">
                            üíµ ${o.cena} z≈Ç | ${o.platnosc}<br>
                            üïí ${o.data.split(',')[1]}
                        </div>
                        <div class="actions">
                            <button class="btn-work" onclick="updateStatus('${o.id}', 'w realizacji')">üî® Robiƒô</button>
                            <button class="btn-ready" onclick="updateStatus('${o.id}', 'gotowe')">üîî GOTOWE</button>
                            <button class="btn-done" onclick="updateStatus('${o.id}', 'zrealizowane')">‚úÖ ZREALIZOWANE</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('orders-list').innerHTML = html || '<p style="opacity:0.5">Brak zam√≥wie≈Ñ...</p>';
            calcSplit();
        } catch(e) { console.error("B≈ÇƒÖd po≈ÇƒÖczenia z API"); }
    }

    async function updateStatus(id, status) {
        await fetch(`${API}/api/admin/status`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id, status })
        });
        fetchData();
    }

    function calcSplit() {
        const count = document.getElementById('emp-count').value || 1;
        document.getElementById('split-value').innerText = (currentRevenue / count).toFixed(2);
    }

    // Zegar i od≈õwie≈ºanie
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
    setInterval(fetchData, 4000);
    fetchData();
</script>

</body>
</html>