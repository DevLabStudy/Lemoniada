<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard üçã</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #FFD600; --accent: #38bdf8; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .box-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .box { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid #334155; }
        .val { font-size: 2.5rem; font-weight: 900; color: var(--primary); display: block; }
        .label { font-size: 0.8rem; text-transform: uppercase; opacity: 0.6; }

        .cups-ui { display: flex; gap: 10px; margin-top: 15px; }
        input { background: #0f172a; border: 1px solid #334155; color: white; padding: 12px; border-radius: 12px; width: 80px; font-size: 1rem; }

        .btn { padding: 12px 20px; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-blue { background: var(--accent); color: #000; }
        .btn-yellow { background: var(--primary); color: #000; }
        .btn-green { background: #10b981; color: #fff; }
        .btn:active { transform: scale(0.95); }

        .pos-card { background: var(--card); border: 2px solid var(--primary); padding: 20px; border-radius: 24px; margin-top: 20px; }
        .admin-cart-item { display: flex; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; margin-bottom: 5px; }

        .order-card { background: var(--card); padding: 15px; border-radius: 15px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--primary); }
    </style>
</head>
<body>
<div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1>Admin Control üçã</h1>
        <div id="status-tag">Sprawdzanie po≈ÇƒÖczenia...</div>
    </div>

    <div class="box-grid">
        <div class="box">
            <span class="label">Utarg ca≈Çkowity</span>
            <span class="val" id="total-rev">0.00 z≈Ç</span>
        </div>
        <div class="box">
            <span class="label">Kubeczki w zapasie</span>
            <span class="val" id="cups-count">0</span>
            <div class="cups-ui">
                <input type="number" id="cups-input" placeholder="Ile?">
                <button class="btn btn-blue" onclick="setCups()">USTAW ZAPAS</button>
            </div>
        </div>
    </div>

    <div class="pos-card">
        <h3>üõí Szybka Sprzeda≈º</h3>
        <div id="pos-list" style="margin-bottom:15px; opacity:0.8;">Koszyk pusty</div>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button class="btn btn-yellow" onclick="addToPos('Zwyk≈Ça', 5)">+ Zwyk≈Ça</button>
            <button class="btn btn-yellow" onclick="addToPos('Pomara≈Ñcz', 7)">+ Pomara≈Ñcz</button>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn btn-green" style="flex:1" onclick="finalizePos('Got√≥wka')">GOT√ìWKA</button>
            <button class="btn btn-blue" style="flex:1; background:#3b82f6; color:#fff;" onclick="finalizePos('BLIK')">BLIK</button>
        </div>
    </div>

    <h2>Aktywne zam√≥wienia</h2>
    <div id="orders-list"></div>
</div>

<script>
    const API = "https://api.lemoniada.com.pl";
    let posCart = [];

    async function load() {
        try {
            const r = await fetch(`${API}/api/admin/data`);
            const d = await r.json();
            document.getElementById('status-tag').innerHTML = "‚óè SYSTEM ONLINE";
            document.getElementById('status-tag').style.color = "#10b981";
            document.getElementById('total-rev').innerText = d.utarg.toFixed(2) + " z≈Ç";
            document.getElementById('cups-count').innerText = d.kubeczki;

            let html = '';
            d.zamowienia.filter(o => o.status !== 'zrealizowane').forEach(o => {
                html += `<div class="order-card">
                    <div><b>#${o.id}</b><br><small>${o.produkty}</small><br><b>${o.cena_total} z≈Ç</b></div>
                    <div>
                        <button class="btn btn-yellow" style="padding:8px" onclick="upStatus('${o.id}','gotowe')">GOTOWE</button>
                        <button class="btn btn-green" style="padding:8px" onclick="upStatus('${o.id}','zrealizowane')">FINISZ</button>
                    </div>
                </div>`;
            });
            document.getElementById('orders-list').innerHTML = html || "Brak zam√≥wie≈Ñ";
        } catch(e) {
            document.getElementById('status-tag').innerHTML = "‚óè ROZ≈ÅƒÑCZONO";
            document.getElementById('status-tag').style.color = "#ef4444";
        }
    }

    // FUNKCJA USTAWIANIA KUBECZK√ìW (KLUCZOWA POPRAWKA)
    async function setCups() {
        const val = document.getElementById('cups-input').value;
        if(!val) return;

        const res = await fetch(`${API}/api/admin/set-kubeczki`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ilosc: parseInt(val) })
        });

        if(res.ok) {
            document.getElementById('cups-count').innerText = val;
            document.getElementById('cups-input').value = "";
            alert("Zaktualizowano magazyn!");
        }
    }

    function addToPos(nazwa, cena) {
        let item = posCart.find(i => i.nazwa === nazwa);
        if(item) item.sztuk++; else posCart.push({nazwa, cena, sztuk: 1});
        renderPos();
    }

    function removeFromPos(nazwa) {
        let item = posCart.find(i => i.nazwa === nazwa);
        if(item) {
            item.sztuk--;
            if(item.sztuk <= 0) posCart = posCart.filter(i => i.nazwa !== nazwa);
        }
        renderPos();
    }

    function renderPos() {
        const list = document.getElementById('pos-list');
        if(posCart.length === 0) { list.innerText = "Koszyk pusty"; return; }
        list.innerHTML = posCart.map(i => `
            <div class="admin-cart-item">
                <span>${i.nazwa} x${i.sztuk}</span>
                <button onclick="removeFromPos('${i.nazwa}')" style="background:red; color:white; border:none; border-radius:5px; cursor:pointer;">USU≈É</button>
            </div>
        `).join('');
    }

    async function finalizePos(platnosc) {
        if(posCart.length === 0) return;
        await fetch(`${API}/api/zamow`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ koszyk: posCart, kod: '', platnosc })
        });
        posCart = []; renderPos(); load();
    }

    async function upStatus(id, status) {
        await fetch(`${API}/api/admin/status`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id, status })
        });
        load();
    }

    setInterval(load, 4000); load();
</script>
</body>
</html>