<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemonade POS</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .cart-box { background: #eee; padding: 15px; border-radius: 15px; margin-top: 20px; }
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 20px; border-radius: 20px; box-shadow: 0 0 50px rgba(0,0,0,0.5); width: 80%; z-index: 100; }
    </style>
</head>
<body>
<div class="app-container">
    <h1 onclick="checkSecret()">Lemonade <span>System</span></h1>

    <div class="menu-grid">
        <div class="card">
            <span>ğŸ‹</span><h3>Klasyczna</h3><p>5 zÅ‚</p>
            <button onclick="addToCart('Klasyczna', 5)">+ Dodaj</button>
        </div>
        <div class="card">
            <span>ğŸŠ</span><h3>PomaraÅ„cza</h3><p>6.5 zÅ‚</p>
            <button onclick="addToCart('PomaraÅ„czowa', 6.5)">+ Dodaj</button>
        </div>
    </div>

    <div class="cart-box">
        <h4>TwÃ³j Koszyk:</h4>
        <div id="cart-list">Pusto</div>
        <hr>
        <p>Suma: <b id="cart-total">0</b> zÅ‚</p>
        <button id="order-btn" onclick="showPayment()" style="display:none; background: #27ae60;">ZAMÃ“W I ZAPÅAÄ†</button>
    </div>

    <div id="tracking"></div>
</div>

<div id="payment-modal" class="modal">
    <h3>Wybierz formÄ™ pÅ‚atnoÅ›ci:</h3>
    <button onclick="finalizuj('GotÃ³wka')" style="margin-bottom:10px">ğŸ’µ GotÃ³wka</button>
    <button onclick="finalizuj('BLIK')" style="background: #eb4d4b">ğŸ“± BLIK</button>
    <button onclick="closePayment()" style="background: gray; margin-top: 10px;">Anuluj</button>
</div>

<script>
    const API = "https://ensemble-seafood-wiki-richard.trycloudflare.com";
    let cart = [];
    let total = 0;

    function addToCart(name, price) {
        cart.push({name, price});
        renderCart();
    }

    function renderCart() {
        const list = document.getElementById('cart-list');
        total = cart.reduce((sum, item) => sum + item.price, 0);
        list.innerHTML = cart.map(i => `â€¢ ${i.name}`).join('<br>');
        document.getElementById('cart-total').innerText = total.toFixed(2);
        document.getElementById('order-btn').style.display = cart.length ? 'block' : 'none';
    }

    function showPayment() { document.getElementById('payment-modal').style.display = 'block'; }
    function closePayment() { document.getElementById('payment-modal').style.display = 'none'; }

    function finalizuj(metoda) {
        if(metoda === 'BLIK') {
            alert("PrzeÅ›lij BLIK na nr: 668 078 310 lub 537 282 634\nTytuÅ‚: Lemoniada x" + cart.length);
        }

        const produktyString = cart.map(i => i.name).join(', ');

        fetch(`${API}/zamow`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ produkty: produktyString, suma: total.toFixed(2), platnosc: metoda })
        })
            .then(res => res.json())
            .then(data => {
                closePayment();
                cart = []; renderCart();
                document.getElementById('tracking').innerHTML = "ZamÃ³wienie wysÅ‚ane! Czekaj na status...";
                startTracking(data.id);
            });
    }

    function startTracking(id) {
        setInterval(() => {
            fetch(`${API}/list-zamowienia`).then(r => r.json()).then(orders => {
                const my = orders.find(o => o.id === id);
                if(my) document.getElementById('tracking').innerHTML = `Status: <b>${my.status}</b>`;
            });
        }, 4000);
    }

    function checkSecret() { /* kod na 5 klikniÄ™Ä‡ bez zmian */ }
</script>
</body>
</html>