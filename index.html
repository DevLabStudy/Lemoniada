<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemoniada u Tobika üçã</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #FFD600; --success: #10b981; }
        body { font-family: sans-serif; background: var(--bg); color: white; text-align: center; padding: 20px; }
        .item { background: var(--card); padding: 20px; border-radius: 20px; margin: 10px auto; max-width: 400px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #334155; }
        .btn-add { background: var(--primary); border: none; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .cart-box { background: var(--primary); color: #000; padding: 20px; border-radius: 20px; margin-top: 20px; }

        /* Styl Pola Kodu */
        input#promo-code { width: 90%; padding: 12px; border-radius: 10px; border: 2px solid #000; margin: 10px 0; font-weight: bold; text-align: center; background: white; color: black; }

        /* Ekran Statusu */
        .status-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--bg); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:9999; }
        .status-card { background: var(--card); padding: 40px; border-radius: 30px; border: 4px solid var(--primary); width: 85%; transition: 0.3s; }
        .big-num { font-size: 5rem; font-weight: 900; color: var(--primary); margin: 10px 0; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 214, 0, 0.7); } 70% { box-shadow: 0 0 0 30px rgba(255, 214, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 214, 0, 0); } }
        .ready { animation: pulse 1.5s infinite; border-color: var(--success) !important; }
    </style>
</head>
<body>

    <h1>üçã Lemoniada üçã</h1>
    <p>Dostƒôpne kubki: <span id="cups">--</span></p>

    <div class="item">
        <span>Klasyczna (5z≈Ç)</span>
        <button class="btn-add" onclick="add('Zwyk≈Ça', 5)">DODAJ</button>
    </div>
    <div class="item">
        <span>Pomara≈Ñcza (7z≈Ç)</span>
        <button class="btn-add" onclick="add('Pomara≈Ñcz', 7)">DODAJ</button>
    </div>

    <div id="cart-ui" class="cart-box" style="display:none">
        <div id="cart-list" style="margin-bottom:10px"></div>
        <input type="text" id="promo-code" placeholder="KOD RABATOWY">
        <button onclick="sendOrder()" style="background:#000; color:#fff; width:100%; padding:15px; border-radius:10px; border:none; font-weight:bold;">ZAM√ìW</button>
    </div>

    <div id="status-screen" class="status-overlay">
        <div id="status-card" class="status-card">
            <div style="font-weight:bold; opacity:0.6">NUMER ZAM√ìWIENIA</div>
            <div id="big-id" class="big-num">#--</div>
            <div id="status-text" style="font-size:1.5rem; font-weight:bold">PRZYJƒòTE</div>
            <p id="status-msg">Czekaj na informacjƒô tutaj...</p>
        </div>
    </div>

    <script>
        const API = "https://api.lemoniada.com.pl";
        let cart = [];

        async function updateStock() {
            const r = await fetch(API + "/api/zapas");
            const d = await r.json();
            document.getElementById('cups').innerText = d.kubeczki;
        }

        function add(n, c) {
            let i = cart.find(x => x.nazwa === n);
            if(i) i.sztuk++; else cart.push({nazwa:n, cena:c, sztuk:1});
            render();
        }

        function remove(n) {
            let i = cart.findIndex(x => x.nazwa === n);
            if(i > -1) {
                if(cart[i].sztuk > 1) cart[i].sztuk--; else cart.splice(i, 1);
            }
            render();
        }

        function render() {
            const ui = document.getElementById('cart-ui');
            const list = document.getElementById('cart-list');
            ui.style.display = cart.length ? 'block' : 'none';
            list.innerHTML = cart.map(x => `<div onclick="remove('${x.nazwa}')" style="margin-bottom:5px">${x.nazwa} x${x.sztuk} (Usu≈Ñ ‚ùå)</div>`).join('');
        }

        async function sendOrder() {
            const res = await fetch(API + "/api/zamow", {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ koszyk: cart, kod: document.getElementById('promo-code').value, platnosc: "Got√≥wka/Blik" })
            });
            const data = await res.json();
            if(data.success) {
                cart = []; render();
                startTracking(data.id);
            }
        }

        function startTracking(id) {
            document.getElementById('status-screen').style.display = 'flex';
            document.getElementById('big-id').innerText = '#' + id;
            const check = setInterval(async () => {
                const r = await fetch(`${API}/api/status/${id}`);
                const d = await r.json();
                const card = document.getElementById('status-card');
                const st = document.getElementById('status-text');

                if(d.status === 'w realizacji') { st.innerText = "W REALIZACJI..."; st.style.color = "#38bdf8"; }
                if(d.status === 'gotowe') {
                    st.innerText = "ODBIERZ!"; card.classList.add('ready');
                    document.getElementById('status-msg').innerText = "ZAPRASZAMY DO STOISKA!";
                }
                if(d.status === 'zrealizowane') { clearInterval(check); location.reload(); }
            }, 3000);
        }

        setInterval(updateStock, 5000); updateStock();
    </script>
</body>
</html>