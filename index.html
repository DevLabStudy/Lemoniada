<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemonade Bar </title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #fffde7; padding: 20px; }
        .hidden { display: none; }
        .box { background: white; padding: 20px; border-radius: 20px; border: 3px solid #fbc02d; max-width: 400px; margin: auto; }
        .pulsate { animation: pulse 1s infinite; font-size: 1.5rem; color: #e67e22; font-weight: bold; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        .num-btn { background: #f8f9fa; border: 1px solid #ddd; padding: 15px; margin: 10px; border-radius: 10px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div id="view-menu" class="box">
        <h1>Lemonade Bar </h1>
        <button onclick="wybierz('Zwyka', 5)">Zwyka (5 z)</button>
        <button onclick="wybierz('Pomaracz', 7)">Pomaracz (7 z)</button>
        <div style="margin-top:20px;">
            <input type="text" id="kod-input" placeholder="Wpisz kod rabatowy">
            <button onclick="losujKod()"> Losuj kod</button>
        </div>
    </div>

    <div id="view-pay" class="box hidden">
        <h2>Patno za <span id="pay-name"></span></h2>
        <button onclick="finalizuj('Got贸wka')"> Got贸wka</button>
        <button onclick="document.getElementById('view-blik').classList.remove('hidden'); document.getElementById('view-pay').classList.add('hidden');"> BLIK</button>
    </div>

    <div id="view-blik" class="box hidden">
        <h3>Skopiuj numer do BLIK:</h3>
        <div class="num-btn" onclick="copy('668078310')">668 078 310</div>
        <div class="num-btn" onclick="copy('537282634')">537 282 634</div>
        <button onclick="finalizuj('BLIK')" style="margin-top:20px; background:#2ecc71; color:white; border:none; padding:10px; border-radius:5px;">POTWIERDZAM PRZELEW</button>
    </div>

    <div id="view-status" class="box hidden">
        <h2>Zam贸wienie #<span id="order-id"></span></h2>
        <div id="st-msg" style="margin:20px; font-weight:bold;">Przyjto do realizacji...</div>
    </div>

    <script>
        let selected = {};
        const API = "https://api.lemoniada.com.pl";

        function wybierz(n, c) {
            selected = { rodzaj: n, cena: c };
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('pay-name').innerText = n;
            document.getElementById('view-pay').classList.remove('hidden');
        }

        function losujKod() {
            if(localStorage.getItem('promo_used')) return alert("Ju偶 losowae!");
            const kody = ["WYGRANA10", "WYGRANA15", "WYGRANA20", "BRAK"];
            const w = kody[Math.floor(Math.random()*kody.length)];
            if(w !== "BRAK") {
                document.getElementById('kod-input').value = w;
                localStorage.setItem('promo_used', 'true');
                alert("Wylosowae: " + w);
            } else { alert("Niestety, spr贸buj jutro!"); }
        }

        function copy(n) {
            navigator.clipboard.writeText(n);
            alert("Skopiowano numer!");
        }

        async function finalizuj(p) {
            const kod = document.getElementById('kod-input').value;
            const res = await fetch(`${API}/api/zamow`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({...selected, kod, platnosc: p})
            });
            const d = await res.json();
            showStatus(d.orderId);
        }

        function showStatus(id) {
            document.querySelectorAll('.box').forEach(b => b.classList.add('hidden'));
            document.getElementById('view-status').classList.remove('hidden');
            document.getElementById('order-id').innerText = id;

            const int = setInterval(async () => {
                const r = await fetch(`${API}/api/status/${id}`);
                const o = await r.json();
                const msg = document.getElementById('st-msg');
                msg.innerText = "Status: " + o.status.toUpperCase();
                if(o.status === 'gotowe') {
                    msg.className = 'pulsate';
                    msg.innerText = "MO呕ESZ PODEJ I ODEBRA! ";
                }
                if(o.status === 'zrealizowane') {
                    clearInterval(int);
                    setTimeout(() => location.reload(), 4000);
                }
            }, 3000);
        }
    </script>
</body>
</html>