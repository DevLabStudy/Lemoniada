<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemoniada ğŸ‹</title>
    <style>
        .hidden { display: none; }
        .pulsate { animation: pulse 1s infinite; color: #d35400; font-weight: bold; font-size: 1.5rem; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .btn-num { background: #eee; padding: 10px; margin: 5px; cursor: pointer; border-radius: 5px; border: 1px solid #ccc; }
        .order-card { border: 2px solid #f1c40f; padding: 20px; border-radius: 15px; text-align: center; }
    </style>
</head>
<body style="font-family: sans-serif; padding: 20px; text-align: center; background: #fffde7;">

    <div id="view-menu">
        <h1>Lemonade Bar ğŸ‹</h1>
        <button onclick="wybierz('zwykla', 5)">ZwykÅ‚a (5 zÅ‚)</button>
        <button onclick="wybierz('pomaranczowa', 7)">PomaraÅ„cz (7 zÅ‚)</button>
        <br><br>
        <input type="text" id="kod-input" placeholder="Masz kod rabatowy?">
        <button onclick="losujKod()">ğŸ€ Losuj kod</button>
    </div>

    <div id="view-payment" class="hidden">
        <h2>Wybierz formÄ™ pÅ‚atnoÅ›ci</h2>
        <button onclick="finalizuj('gotÃ³wka')">ğŸ’µ GotÃ³wka</button>
        <button onclick="pokazBlik()">ğŸ“² BLIK</button>
    </div>

    <div id="view-blik" class="hidden">
        <h3>Kliknij numer, aby skopiowaÄ‡:</h3>
        <div class="btn-num" onclick="copy('668078310')">668 078 310</div>
        <div class="btn-num" onclick="copy('537282634')">537 282 634</div>
        <p>Po wykonaniu przelewu kliknij:</p>
        <button onclick="finalizuj('blik')">POTWIERDZAM PRZELEW</button>
    </div>

    <div id="view-status" class="hidden order-card">
        <h2>Twoje zamÃ³wienie: #<span id="order-no"></span></h2>
        <div id="status-text" style="font-size: 1.2rem; margin: 20px;">Czekamy na potwierdzenie...</div>
    </div>

    <script>
        const API = "https://api.lemoniada.com.pl";
        let currentOrder = { rodzaj: '', cena: 0 };

        function wybierz(r, c) {
            currentOrder = { rodzaj: r, cena: c };
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('view-payment').classList.remove('hidden');
        }

        function losujKod() {
            const used = localStorage.getItem('used_win_code');
            if(used) return alert("JuÅ¼ losowaÅ‚eÅ› kod!");

            const kody = ["WYGRANA10", "WYGRANA15", "WYGRANA20", "BRAK"];
            const wylosowany = kody[Math.floor(Math.random() * kody.length)];

            if(wylosowany !== "BRAK") {
                alert("WygraÅ‚eÅ›: " + wylosowany);
                document.getElementById('kod-input').value = wylosowany;
                localStorage.setItem('used_win_code', 'true');
            } else { alert("Nic tym razem ğŸ‹"); }
        }

        function copy(nr) {
            navigator.clipboard.writeText(nr);
            alert("Skopiowano numer: " + nr);
        }

        function pokazBlik() {
            document.getElementById('view-payment').classList.add('hidden');
            document.getElementById('view-blik').classList.remove('hidden');
        }

        async function finalizuj(typ) {
            const kod = document.getElementById('kod-input').value;
            const res = await fetch(`${API}/api/zamow`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ ...currentOrder, kod, platnosc: typ })
            });
            const d = await res.json();
            startStatusCheck(d.orderId);
        }

        function startStatusCheck(id) {
            document.querySelectorAll('div').forEach(d => d.classList.add('hidden'));
            document.getElementById('view-status').classList.remove('hidden');
            document.getElementById('order-no').innerText = id;

            const interval = setInterval(async () => {
                const r = await fetch(`${API}/api/status/${id}`);
                const d = await r.json();
                const st = document.getElementById('status-text');

                st.innerText = "Status: " + d.status.toUpperCase();
                st.className = (d.status === 'gotowe') ? 'pulsate' : '';
                if(d.status === 'gotowe') st.innerText = "MOÅ»ESZ PODEJÅšÄ† I ODEBRAÄ† ZAMÃ“WIENIE! ğŸ‹";

                if(d.status === 'zrealizowane') {
                    clearInterval(interval);
                    setTimeout(() => location.reload(), 3000);
                }
            }, 3000);
        }
    </script>
</body>
</html>