<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemoniada Bar - Zam贸w Online</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f1c40f; margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .app { max-width: 450px; width: 100%; background: white; padding: 25px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; height: fit-content; }

        .product-card { border: 2px solid #f9f9f9; padding: 15px; border-radius: 20px; margin: 15px 0; display: flex; align-items: center; justify-content: space-between; transition: 0.3s; }
        .product-card:hover { border-color: #f1c40f; }

        .btn-add { background: #2ecc71; color: white; border: none; padding: 12px 20px; border-radius: 12px; cursor: pointer; font-weight: bold; }

        #cart-area { display: none; border-top: 3px dashed #eee; margin-top: 25px; padding-top: 20px; }
        .payment-box { text-align: left; background: #f7f7f7; padding: 15px; border-radius: 15px; margin: 15px 0; border: 1px solid #eee; }

        .order-status { background: #fffde7; padding: 20px; border-radius: 20px; margin-top: 20px; border: 4px solid #f1c40f; animation: pulse 2s infinite; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* Nakadka PRZERWA */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.96); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; text-align: center; padding: 20px; }
    </style>
</head>
<body>

<div id="closed-screen" class="overlay">
    <span style="font-size: 80px;">锔</span>
    <h1 style="color: #e74c3c; font-size: 32px; margin: 10px 0;">PRZERWA TECHNICZNA</h1>
    <p id="closed-msg" style="font-size: 18px; color: #555;"></p>
    <p style="color: #aaa;">Zajrzyj do nas za kilka minut!</p>
</div>

<div class="app">
    <h1 style="margin-bottom: 5px;"> Lemonade Bar</h1>
    <p style="color: #888; margin-top: 0;">Najlepsza ochoda w miecie!</p>

    <div class="product-card">
        <div style="text-align: left;">
            <b style="font-size: 18px;">Lemoniada Klasyczna</b><br>
            <span style="color: #2ecc71; font-weight: bold;">5.00 z</span>
        </div>
        <button class="btn-add" onclick="addToCart('Klasyczna', 5.00)">DODAJ</button>
    </div>

    <div class="product-card">
        <div style="text-align: left;">
            <b style="font-size: 18px;">Lemoniada Pomaraczowa</b><br>
            <span style="color: #2ecc71; font-weight: bold;">6.50 z</span>
        </div>
        <button class="btn-add" onclick="addToCart('Pomaraczowa', 6.50)">DODAJ</button>
    </div>

    <div id="cart-area">
        <p id="cart-items" style="font-weight: bold; color: #555;"></p>
        <h2 style="margin: 10px 0;">Suma: <span id="cart-total" style="color: #2ecc71;">0.00</span> z</h2>

        <div class="payment-box">
            <b>Metoda patnoci:</b><br>
            <div style="margin-top: 8px;">
                <label><input type="radio" name="pay-method" value="BLIK" checked> BLIK (pacisz kodem przy odbiorze)</label><br><br>
                <label><input type="radio" name="pay-method" value="Got贸wka"> Got贸wka (przy odbiorze)</label>
            </div>
        </div>

        <button class="btn-add" style="width: 100%; padding: 18px; font-size: 18px; background: #27ae60;" onclick="sendOrder()">ZAMW I ODBIERZ</button>
    </div>

    <div id="status-container"></div>
</div>

<script>
    const API = "https://bacterial-concept-scripting-expired.trycloudflare.com";
    let cart = [];

    function addToCart(name, price) {
        cart.push({name, price});
        document.getElementById('cart-area').style.display = 'block';
        document.getElementById('cart-items').innerText = "Wybrano: " + cart.map(i => i.name).join(", ");
        document.getElementById('cart-total').innerText = cart.reduce((sum, item) => sum + item.price, 0).toFixed(2);
    }

    function sendOrder() {
        const total = cart.reduce((s, i) => s + i.price, 0).toFixed(2);
        const items = cart.map(i => i.name).join(", ");
        const method = document.querySelector('input[name="pay-method"]:checked').value;

        fetch(`${API}/zamow`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ produkty: items, suma: total, platnosc: method })
        }).then(r => r.json()).then(data => {
            alert("Zam贸wienie przyjte! Zapraszamy do stoiska.");
            cart = [];
            document.getElementById('cart-area').style.display = 'none';
            trackMyOrder(data.id);
        }).catch(() => alert("Bd poczenia z serwerem!"));
    }

    function trackMyOrder(id) {
        const container = document.getElementById('status-container');
        const checkInterval = setInterval(() => {
            fetch(`${API}/list-zamowienia`).then(r => r.json()).then(data => {
                const myOrder = data.find(o => o.id === id);
                if(myOrder) {
                    let statusColor = "#f1c40f";
                    let msg = "Twoje zam贸wienie zostao przyjte!";

                    if(myOrder.status === 'W REALIZACJI') { statusColor = "#3498db"; msg = "Wyciskamy owoce... "; }
                    if(myOrder.status === 'DO ODBIORU') { statusColor = "#2ecc71"; msg = "GOTOWA! Zapraszamy po odbi贸r! "; }
                    if(myOrder.status === 'WYDANE') {
                        container.innerHTML = "<h3>Dzikujemy! Smacznego! </h3>";
                        clearInterval(checkInterval);
                        setTimeout(() => { container.innerHTML = ""; }, 5000);
                        return;
                    }

                    container.innerHTML = `
                            <div class="order-status" style="border-color: ${statusColor}">
                                <small>Zam贸wienie #${id}</small>
                                <h2 style="margin: 10px 0; color: ${statusColor}">${myOrder.status}</h2>
                                <p style="font-weight: bold;">${msg}</p>
                            </div>`;
                }
            });
        }, 4000);
    }

    // Monitoring statusu stoiska (przerwy)
    setInterval(() => {
        fetch(`${API}/stan-magazynu`).then(r => r.json()).then(data => {
            const screen = document.getElementById('closed-screen');
            if(data.przerwa) {
                screen.style.display = 'flex';
                document.getElementById('closed-msg').innerText = data.powod;
            } else {
                screen.style.display = 'none';
            }
        });
    }, 5000);
</script>
</body>
</html>