<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemonade Bar</title>
    <style>
        :root { --yellow: #FFD600; --dark: #1A1A1A; --gray: #F5F5F5; }
        body { font-family: 'Inter', sans-serif; background: var(--gray); margin: 0; padding: 20px; color: var(--dark); }
        .app { max-width: 400px; margin: auto; }
        .card { background: white; border-radius: 24px; padding: 24px; box-shadow: 0 8px 24px rgba(0,0,0,0.05); margin-bottom: 16px; border: 1px solid rgba(0,0,0,0.05); }
        h1 { font-size: 28px; font-weight: 800; margin: 0 0 8px 0; }
        .product { display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--gray); border-radius: 16px; margin-bottom: 12px; cursor: pointer; transition: 0.2s; border: 2px solid transparent; }
        .product:active { transform: scale(0.98); border-color: var(--yellow); }
        .btn-main { background: var(--yellow); border: none; width: 100%; padding: 18px; border-radius: 16px; font-weight: 700; font-size: 16px; cursor: pointer; margin-top: 12px; }
        .promo-section { display: flex; gap: 8px; margin-top: 16px; }
        input { flex: 1; padding: 12px; border-radius: 12px; border: 1px solid #DDD; }
        .blik-option { padding: 16px; border: 1px solid #DDD; border-radius: 12px; margin-top: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .pulsate { animation: pulse 1.5s infinite; color: #FF6D00; font-weight: 800; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="app">
        <div id="step-1">
            <div class="card">
                <h1>Lemonade Bar </h1>
                <p>Wybierz orze藕wienie na dzi:</p>
                <div class="product" onclick="setProduct('Zwyka', 5)">
                    <span> Zwyka Lemoniada</span><b>5.00 z</b>
                </div>
                <div class="product" onclick="setProduct('Pomaracz', 7)">
                    <span> Pomaraczowa</span><b>7.00 z</b>
                </div>
                <div class="promo-section">
                    <input type="text" id="promo-input" placeholder="Kod rabatowy">
                    <button onclick="luckyDraw()" style="border:none; background:white; cursor:pointer;"></button>
                </div>
            </div>
        </div>

        <div id="step-2" class="hidden">
            <div class="card">
                <h1>Patno </h1>
                <p>Wybrae: <b id="summary-name"></b></p>
                <button class="btn-main" onclick="pay('Got贸wka')"> Zapac Got贸wk</button>
                <p style="margin-top: 20px; font-size: 12px; color: #888;">LUB PRZELEW BLIK:</p>
                <div class="blik-option" onclick="copyBlik('668078310')"><span> 668 078 310</span> </div>
                <div class="blik-option" onclick="copyBlik('537282634')"><span> 537 282 634</span> </div>
                <button class="btn-main" style="background:#000; color:white; margin-top:16px;" onclick="pay('BLIK')">Potwierdzam przelew</button>
            </div>
        </div>

        <div id="step-3" class="hidden">
            <div class="card" style="text-align: center;">
                <p>Twoje zam贸wienie</p>
                <h1 id="order-id">#---</h1>
                <div id="status-msg" style="margin: 24px 0; font-size: 18px;">Przyjte do kuchni...</div>
            </div>
        </div>
    </div>

    <script>
        const API = "https://api.lemoniada.com.pl";
        let orderData = { produkt: '', cena: 0 };

        function setProduct(name, price) {
            orderData.produkt = name; orderData.cena = price;
            document.getElementById('summary-name').innerText = name + " (" + price + "z)";
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
        }

        function luckyDraw() {
            if(localStorage.getItem('draw')) return alert("Ju偶 losowae!");
            const wins = ["WYGRANA10", "WYGRANA15", "WYGRANA20", "BRAK"];
            const res = wins[Math.floor(Math.random()*wins.length)];
            if(res !== "BRAK") {
                document.getElementById('promo-input').value = res;
                alert("GRATULACJE! Tw贸j kod: " + res);
            } else alert("Nic tym razem!");
            localStorage.setItem('draw', '1');
        }

        function copyBlik(nr) {
            navigator.clipboard.writeText(nr);
            alert("Skopiowano numer!");
        }

        async function pay(method) {
            const kod = document.getElementById('promo-input').value;
            const res = await fetch(`${API}/api/zamow`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({...orderData, platnosc: method, kod})
            });
            const d = await res.json();
            trackStatus(d.id);
        }

        function trackStatus(id) {
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');
            document.getElementById('order-id').innerText = "#" + id;

            const check = setInterval(async () => {
                const r = await fetch(`${API}/api/status/${id}`);
                const d = await r.json();
                const msg = document.getElementById('status-msg');
                msg.innerText = d.status.toUpperCase();

                if(d.status === 'gotowe') {
                    msg.classList.add('pulsate');
                    msg.innerText = "ODBIERZ ZAMWIENIE! ";
                }
                if(d.status === 'zrealizowane') {
                    clearInterval(check);
                    setTimeout(() => location.reload(), 4000);
                }
            }, 3000);
        }
    </script>
</body>
</html>