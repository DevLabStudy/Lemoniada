<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Lemonade System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app-container">
    <h1 id="secret-btn" onclick="checkSecret()">Lemonade <span>System</span></h1>

    <div class="menu-grid">
        <div class="card">
            <span>üçã</span>
            <h3>Klasyczna</h3>
            <button onclick="wyslijZamowienie('Klasyczna')">5.00 z≈Ç</button>
        </div>
        <div class="card">
            <span>üçä</span>
            <h3>Pomara≈Ñczowa</h3>
            <button onclick="wyslijZamowienie('Pomara≈Ñczowa')">6.50 z≈Ç</button>
        </div>
    </div>

    <div id="tracking"></div>
</div>

<script>
    const API = "https://ensemble-seafood-wiki-richard.trycloudflare.com";
    let secretClicks = 0;

    function checkSecret() {
        secretClicks++;
        if(secretClicks >= 5) {
            const p = prompt("PIN:");
            if(p === "1337") window.location.href = "admin-tajne.html";
        }
    }

    function wyslijZamowienie(produkt) {
        fetch(`${API}/zamow`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ produkt: produkt })
        })
            .then(res => res.json())
            .then(data => startTracking(data.id, produkt));
    }

    function startTracking(id, nazwa) {
        const trackDiv = document.getElementById('tracking');
        const interval = setInterval(() => {
            fetch(`${API}/list-zamowienia`)
                .then(r => r.json())
                .then(orders => {
                    const myOrder = orders.find(o => o.id === id);
                    if(myOrder) {
                        trackDiv.innerHTML = `<div class="status-box">Twoja <b>${nazwa}</b> jest w etapie:<br>
                        <b style="color: #d39e00">${myOrder.status}</b></div>`;
                        if(myOrder.status === 'GOTOWE') {
                            trackDiv.innerHTML = `<div class="status-box" style="background:#d4edda">ODEBIERZ! üçã</div>`;
                            clearInterval(interval);
                        }
                    }
                });
        }, 3000);
    }
</script>
</body>
</html>