<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemoniada Bar</title>
    <style>
        body { font-family: sans-serif; background: linear-gradient(135deg, #f1c40f, #f39c12); margin: 0; display: flex; justify-content: center; min-height: 100vh; padding: 20px; }
        .app { max-width: 400px; width: 100%; background: white; padding: 25px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); text-align: center; height: fit-content; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .card { background: #fff; padding: 15px; border-radius: 15px; border: 1px solid #eee; display: flex; flex-direction: column; justify-content: space-between; min-height: 180px; }
        .card span { font-size: 40px; }
        .add-btn { background: #2ecc71; color: white; border: none; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .status-box { background: #f9f9f9; padding: 15px; border-radius: 15px; margin-top: 20px; border: 3px solid #eee; }
        .admin-dot { position: fixed; bottom: 5px; right: 5px; width: 20px; height: 20px; background: rgba(0,0,0,0.03); border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body>
<div class="app">
    <h1>Lemonade <span>System</span></h1>

    <div class="grid">
        <div class="card">
            <span>üçã</span>
            <h4>Klasyk</h4>
            <p>5.00 z≈Ç</p>
            <button class="add-btn" onclick="addToCart('Klasyczna', 5)">Dodaj</button>
        </div>
        <div class="card">
            <span>üçä</span>
            <h4>Pomara≈Ñcz</h4>
            <p>6.50 z≈Ç</p>
            <button class="add-btn" onclick="addToCart('Pomara≈Ñczowa', 6.5)">Dodaj</button>
        </div>
    </div>

    <div id="cart" style="display:none; border-top: 2px dashed #eee; padding-top: 15px;">
        <p id="cart-items"></p>
        <h3>Suma: <span id="cart-total">0</span> z≈Ç</h3>
        <button class="add-btn" style="width:100%; padding:15px;" onclick="sendOrder()">ZAM√ìW I ZAP≈ÅAƒÜ</button>
    </div>

    <div id="status-area"></div>
</div>

<div class="admin-dot" onclick="checkAdmin()"></div>

<script>
    const API = "https://bacterial-concept-scripting-expired.trycloudflare.com";
    let cart = [];
    let clicks = 0;

    function checkAdmin() {
        clicks++;
        if(clicks >= 5) {
            let p = prompt("PIN:");
            if(p === "1337") window.location.href = "admin-tajne.html";
        }
        setTimeout(() => clicks = 0, 3000);
    }

    function addToCart(name, price) {
        cart.push({name, price});
        document.getElementById('cart').style.display = 'block';
        document.getElementById('cart-items').innerText = cart.map(i => i.name).join(", ");
        document.getElementById('cart-total').innerText = cart.reduce((s, i) => s + i.price, 0).toFixed(2);
    }

    function sendOrder() {
        const total = cart.reduce((s, i) => s + i.price, 0).toFixed(2);
        const items = cart.map(i => i.name).join(", ");
        fetch(`${API}/zamow`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ produkty: items, suma: total, platnosc: 'BLIK' })
        }).then(r => r.json()).then(data => {
            alert("Zam√≥wienie przyjƒôte!");
            document.getElementById('cart').style.display = 'none';
            cart = [];
            trackOrder(data.id);
        });
    }

    function trackOrder(id) {
        const area = document.getElementById('status-area');
        const itv = setInterval(() => {
            fetch(`${API}/list-zamowienia`).then(r => r.json()).then(data => {
                const z = data.find(o => o.id === id);
                if(z) {
                    let col = "#f1c40f";
                    if(z.status === 'W REALIZACJI') col = "#3498db";
                    if(z.status === 'DO ODBIORU') col = "#2ecc71";
                    if(z.status === 'WYDANE') {
                        area.innerHTML = "<h4>Dziƒôkujemy! Smacznej lemoniady! üçã</h4>";
                        clearInterval(itv);
                        return;
                    }
                    area.innerHTML = `
                            <div class="status-box" style="border-color: ${col}">
                                <small>Zam√≥wienie #${id}</small>
                                <h3 style="color:${col}">${z.status}</h3>
                                ${z.status === 'DO ODBIORU' ? '<b>ZAPRASZAMY PO ODBI√ìR! üéâ</b>' : ''}
                            </div>`;
                }
            });
        }, 4000);
    }
</script>
</body>
</html>